<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">	
  <title>Feria de Abril - Plataforma</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Login y Registro -->
  <div class="container active" id="login-container">
    <h2 class="titulo-principal">Iniciar SesiÃ³n</h2>
    <form id="login-form">
      <input type="text" id="login-user" placeholder="Correo o alias" required>
      <input type="password" id="login-password" placeholder="ContraseÃ±a" required>
      <button type="submit">Acceder</button>
    </form>
  
  </div>
  
  <div class="container" id="register-container">
    <h2>Registro</h2>
    <form id="register-form">
      <input type="email" id="register-email" placeholder="Correo electrÃ³nico" required>
      <input type="text" id="alias" placeholder="Alias o nombre" required>
      <input type="password" id="register-password" placeholder="ContraseÃ±a" required>
      <select id="role">
        <option value="socio">Socio</option>
        <option value="familiar">Familiar</option>
        <option value="invitado">Invitado</option>
        <option value="portero">Portero</option>
        <option value="restaurante">Restaurante</option>
		<option value="camarero">Camarero</option>
        <option value="admin">Administrador</option>
      </select>
      <button type="submit">Registrarse</button>
    </form>
    <p class="form-link">Â¿Ya tienes cuenta? <a href="#" id="to-login">Inicia sesiÃ³n</a></p>
  </div>
  
  <!-- AplicaciÃ³n Principal -->
  <div id="main-app" style="display:none; width: 100%; max-width: 400px;">
    <!-- Header -->
    <div id="header">
      <button id="btn-home">Inicio</button>
      <button id="btn-logout">Cerrar SesiÃ³n</button>
    </div>
    
    <div id="content">
      <!-- MenÃº de Opciones -->
      <div class="container active" id="menu-container">
        <h2>Tipo: <span id="user-type"></span></h2>
        <div class="menu-grid">
          <!-- Botones generados dinÃ¡micamente segÃºn el rol -->
        </div>
      </div>
      
	<div id="carta-page" class="container">
	  <h2>Carta del Restaurante</h2>
	  <div id="carta-lista" class="restaurant-box-menu"></div>
	</div>


	  
      <!-- Vista de QR de Entrada -->
      <div class="container" id="entry-qr-page">
        <h2>CÃ³digo QR de Entrada</h2>
        <div id="entry-qr-code"></div>
        <p style="text-align:center; color: white;">Tu cÃ³digo Ãºnico de entrada</p>
        <p id="user-role-display"></p>
      </div>
      
      
	<!-- Dashboard Restaurante -->
	<div class="container" id="dashboard">
	  <h2>ðŸ“Š Dashboard del Restaurante</h2>
	  <p><strong>Total recargas realizadas:</strong> <span id="total-recargas">â€”</span></p>
	  <p><strong>Total ventas:</strong> <span id="total-ventas">â€”</span></p>

	<div id="restaurant-box-transactions" class="restaurant-box-transactions">
	  <h3>ðŸ‘¤ Socios</h3>
	  <ul id="resumen-socios"></ul>

	  <h3>ðŸ‘ª Familiares</h3>
	  <ul id="resumen-familiares"></ul>
	  </div>
	</div>
	
	

	<!-- Dashboard Portero -->
	<div class="container" id="dashboard-portero">
	  <h2>ðŸ“‹ Registro de Invitados Escaneados</h2>
	  
	  <ul id="lista-entradas-portero" style="max-height: 550px; overflow-y: auto;" class="portero-box-menu"></ul>
	</div>


      
      
	<!-- EscÃ¡ner QR -->
	<div class="container" id="scanner-page">
	  <h2>Escanear CÃ³digo</h2>
	  
	  <!-- AquÃ­ aparece la cÃ¡mara -->
	  <div id="reader" style="width: 100%; max-width: 300px; margin: 0 auto; border: 2px solid #ccc; border-radius: 10px;"></div>

	  <!-- Resultado del escaneo -->
	  <div id="resultado" style="margin-top: 10px; text-align: center; color: white;"></div>
	</div>

      
      <!-- Chat -->
	  
      <div class="container" id="chat-page">
        <h2>Chat</h2>
        <div id="chat-messages"></div>
        <textarea id="chat-input" placeholder="Escribe tu mensaje" rows="3"></textarea>
        <button onclick="enviarMensaje()">Enviar</button>
      </div>
      
	  
<!-- Eventos (SubmenÃº para Administrador) -->
<div class="container" id="eventos-page">
  <h2>Eventos</h2>
  <div id="eventos-menu" class="menu-buttons">
    <button onclick="mostrarOpcion('registrar-evento-page')">Registrar Evento</button>
    <button onclick="mostrarOpcion('ver-eventos-page'); cargarEventos();">Ver Eventos</button>
  </div>
</div>

<!-- Registrar Evento (Solo para Admin) -->
<div class="container" id="registrar-evento-page">
  <h2>Registrar Evento</h2>
  <div id="formulario-evento">
    <form onsubmit="event.preventDefault(); crearEvento();">
      <label>DÃ­a:</label>
      <input type="date" id="nuevo-evento-dia" required>
      <label>Hora:</label>
      <input type="time" id="nuevo-evento-hora" required>
      <label>Evento:</label>
      <input type="text" id="nuevo-evento-descripcion" placeholder="DescripciÃ³n del evento" required>
      <button type="submit">Publicar Evento</button>
    </form>
  </div>
</div>

<!-- Ver Eventos (Para Admin, Socios y Familiares) -->
<div class="container" id="ver-eventos-page">
  <h2>Eventos Registrados</h2>
  <div id="ver-eventos-lista" class="eventos-box-menu"></div>
</div>
	
	<!-- InformaciÃ³n del Tiempo -->
	<div class="container" id="tiempo-page">
	  <h2>InformaciÃ³n MeteorolÃ³gica</h2>
	  <div id="tiempo-actual">Cargando tiempo actual...</div>
	  <h3>PrÃ³ximos dÃ­as</h3>
	  <div id="tiempo-pronostico"></div>
	</div>


	  
      <!-- SubmenÃº Wallet -->
      <div class="container" id="wallet-menu">
        <h2>Opciones de Wallet</h2>
        <div class="menu-buttons">
          <button onclick="mostrarOpcion('wallet-page')">Monedero</button>
          <button onclick="mostrarOpcion('payments-page')">Pago</button>
          <button onclick="mostrarOpcion('recarga-familiar-page'); cargarFamiliaresParaRecarga();">Recargar Familiar</button>
        </div>
      </div>
      
      <!-- Monedero Virtual -->
      <div class="container" id="wallet-page">
        <h2>Monedero Virtual</h2>
        <div class="saldo-destacado">
          <span>Saldo actual:</span>
          <div class="saldo-cantidad" id="wallet-balance-container">0 â‚¬</div>
        </div>
		<h3>Historial de Transacciones</h3>
		<div id="wallet-transactions" class="wallet-box-transactions">
		  <!-- AquÃ­ se inyectarÃ¡n los movimientos -->
		</div>
      </div>
      
      <!-- Pagos -->
	<div id="payments-page" class="container">
	  <button class="back-button">AtrÃ¡s</button>
	  <form id="payment-form">
		<input type="number" id="payment-amount" placeholder="Cantidad a pagar" step="0.01" min="0">
		<button type="submit">Generar QR de Pago</button>
	  </form>
	  <div id="payment-qr" align='center'></div>
	  <p id="resultado-pago"></p>
	</div>
      
      <!-- Recarga a Familiar -->
      <div class="container" id="recarga-familiar-page">
        <h2>Recargar Familiar</h2>
        <form id="recarga-familiar-form">
          <select id="select-familiar" required>
            <option value="">Seleccione un familiar</option>
          </select>
          <input type="number" id="familiar-recarga-amount" placeholder="Cantidad a transferir" required>
          <button type="submit">Transferir</button>
        </form>
      </div>
      
      <!-- SubmenÃº AdministraciÃ³n -->
      <div class="container" id="admin-menu">
        <h2>AdministraciÃ³n</h2>
        <div id="admin-buttons">
          <!-- Botones generados dinÃ¡micamente segÃºn permisos -->
        </div>
      </div>
	  
	   <!-- SubmenÃº AdministraciÃ³n Restaurante-->
	  <div id="gestionar-camareros-page" class="container">
	    <h2>GestiÃ³n de Camareros</h2>
	    <button onclick="mostrarOpcion('formulario-camarero')">AÃ±adir Camarero</button>
	    <div id="camareros-list"></div>
	  </div>
	  
	
	
	<!-- AÃ±adir Camarero (Restaurante) -->
	<div class="container" id="formulario-camarero">
	  <form id="formulario-camarero-form">
		<input type="email" id="nuevoCamareroEmail" placeholder="Correo del camarero" required>
		<input type="text" id="nuevoCamareroAlias" placeholder="Alias del camarero" required>
		<input type="password" id="nuevoCamareroPassword" placeholder="ContraseÃ±a" required>
		<button type="submit">Registrar</button>
	  </form>
	</div>


      
      <!-- Panel de AdministraciÃ³n -->
      <div class="container" id="admin-page">
        <h2>Panel de AdministraciÃ³n</h2>
        <h3>Usuarios</h3>
        <div id="admin-users" class="admin-box-menu"></div>
      </div>
      
      <!-- AÃ±adir Usuario (Admin) -->
      <div class="container" id="add-user-page">
        <h2>AÃ±adir Usuario</h2>
        <form id="add-user-form">
          <input type="email" id="new-user-email" placeholder="Correo electrÃ³nico" required>
          <input type="text" id="new-user-alias" placeholder="Alias o nombre" required>
          <input type="password" id="new-user-password" placeholder="ContraseÃ±a" required>
          <select id="new-user-role">
            <option value="socio">Socio</option>
			<option value="restaurante">Restaurante</option>
            <option value="portero">Portero</option>
			<option value="admin">Administrador</option>
          </select>
          <button type="submit">AÃ±adir Usuario</button>
        </form>
      </div>
      
      <!-- Ver Socios (Admin) -->
      <div class="container" id="view-socios-page">
        <h2>Socios Agregados</h2>
        <div id="socios-list" class="socios-box-menu"></div>
      </div>
      
      <!-- AÃ±adir Familiar (Socio) -->
      <div class="container" id="add-familiar-page">
        <h2>AÃ±adir Familiar</h2>
        <form id="add-familiar-form">
          <input type="email" id="new-familiar-email" placeholder="Correo electrÃ³nico" required>
          <input type="text" id="new-familiar-alias" placeholder="Alias o nombre" required>
          <input type="password" id="new-familiar-password" placeholder="ContraseÃ±a" required>
          <button type="submit">AÃ±adir Familiar</button>
        </form>
      </div>
      
      <!-- AÃ±adir Invitado (Socio) -->
      <div class="container" id="add-invited-page">
        <h2>AÃ±adir Invitado</h2>
        <form id="add-invited-form">
          <input type="email" id="new-invited-email" placeholder="Correo electrÃ³nico" required>
          <input type="text" id="new-invited-alias" placeholder="Alias o nombre" required>
          <input type="password" id="new-invited-password" placeholder="ContraseÃ±a" required>
          <button type="submit">AÃ±adir Invitado</button>
        </form>
      </div>
      
      <!-- Ver Familiares (Socio) -->
      <div class="container" id="view-familiares-page">
        <h2>Familiares Agregados</h2>
        <div id="familiares-list" class="user-list"></div>
      </div>
      
      <!-- Ver Invitados (Socio) -->
      <div class="container" id="view-invited-page">
        <h2>Invitados Agregados</h2>
        <div id="invitados-list" class="user-list"></div>
      </div>
      
      <!-- Vista Wallet Restaurante -->
      <div class="container" id="wallet-restaurante">
        <h2>GestiÃ³n de Monedero</h2>
        <div class="menu-buttons">
          <button onclick="mostrarSeccionWallet('extracto-recargas')">Consulta de Recargas</button>
          <button onclick="mostrarSeccionWallet('extracto-ventas')">Consulta de Ventas</button>
        </div>

        <div id="extracto-recargas" style="margin-top:20px; display:none;">
          <h3>Recargas Realizadas</h3>
          <div id="lista-recargas" class="wallet-box-transactions"></div>
        </div>

        <div id="extracto-ventas" style="margin-top:20px; display:none;">
          <h3>Ventas Realizadas</h3>
          <div id="lista-ventas" class="wallet-box-transactions"></div>
        </div>
      </div>
      
      <!-- Recarga (Restaurante) -->
      <div class="container" id="recarga-page">
        <h2>Recargar Socios</h2>
        <form id="recarga-form">
          <select id="recarga-socio-select" required>
            <option value="">Seleccione un socio</option>
          </select>
          <input type="number" id="recarga-amount" placeholder="Cantidad a recargar" required>
          <button type="submit">Recargar</button>
        </form>
        <div id="recarga-socios-list" class="user-list"></div>
      </div>
	  
		<div id="submenu-restaurante" class="container">
		  <h2>GestiÃ³n del Restaurante</h2>
		  <div class="menu-buttons">
			<button onclick="mostrarOpcion('gestionar-camareros-page'); prepararVistaGestionCamareros();">
			  Camareros
			</button>
		  </div>
		</div>
		
		<div id="restaurante-buttons"> </div>

      
      <!-- Esquema de Relaciones -->
      <div class="container" id="relaciones-page">
        <h2>Relaciones de Usuarios</h2>
        <div id="esquema-usuarios" class="relationship-diagram"></div>
      </div>
    </div>
  </div>
  
  <!-- Vista para Camarero -->
<div class="container" id="camarero-page">
  <h2>Panel de Camarero</h2>
  <div class="menu-buttons">
    <button onclick="mostrarOpcion('scanner-page')">Escanear QR de Pago</button>
    <button onclick="cerrarSesion()">Cerrar SesiÃ³n</button>
  </div>
  <!-- Reutilizamos el contenedor del escÃ¡ner -->
  <div id="scanner-page" class="container" style="display: none;">
    <h2>Escanear CÃ³digo de Pago</h2>
    <div id="reader" style="width: 100%; max-width: 300px; margin: 0 auto; border: 2px solid #ccc; border-radius: 10px;"></div>
    <div id="resultado" style="margin-top: 10px; text-align: center; color: white;"></div>
	

  </div>
</div>
  
  


  <script src="qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="html5-qrcode.min.js"></script>	
  <script src="https://unpkg.com/html5-qrcode.min.js"></script>
  <script src="script.js"></script>
</body>
</html>
